#cloud-config
coreos:
  update:
    reboot-strategy: "off"
  units:
    - name: telegraf.service
      command: start
      enable: true
      content: |
        [Unit]
        Description=Teleport Monitoring Agent
        After=network-online.target
        After=etcd-member.service
        [Service]
        Restart=on-failure
        ExecStart=/bin/rkt run \
          --stage1-name=coreos.com/rkt/stage1-fly:1.26.0 \
          --set-env TELEGRAF_GLOBAL_TAGS_CLUSTER=production \
          --set-env TELEGRAF_GLOBAL_TAGS_SERVICE=etcd \
          --set-env HOST_ETC=/etc2 \
          --interactive \
          --volume=varlibetcd2,kind=host,source=/var/lib/etcd2 \
          --volume=etc,kind=host,source=/etc \
          --mount volume=etc,target=/etc2 \
          --mount volume=varlibetcd2,target=/var/lib/etcd2 \
          --hostname=%H \
          --dns=host \
          --net=host \
          --insecure-options=image,ondisk \
          docker://checkr/checkr-telegraf-kapacitor:latest \
          --exec /usr/bin/telegraf -- --config /etc/generic.system.telegraf.conf
        
    - name: cfn-etcd-environment.service
      enable: true
      command: start
      runtime: true
      content: |
        [Unit]
        Description=Configures EBS volume and R53 record set for this node and derives env vars for etcd bootstrap
        After=network-online.target
        Before=format-etcd2-volume.service

        [Service]
        EnvironmentFile=/var/run/coreos/etcd-node.env
        Restart=on-failure
        RemainAfterExit=true
        ExecStartPre=/opt/bin/cfn-etcd-environment
        ExecStartPre=/usr/bin/mv -f /var/run/coreos/etcd-environment /etc/etcd-environment
        ExecStart=/bin/true
        TimeoutStartSec=120

        [Install]
        RequiredBy=format-etcd2-volume.service

    - name: etcdadm-reconfigure.service
      enable: true
      content: |
        [Unit]
        Description=etcdadm reconfigure runner
        BindsTo=etcd-member.service
        Before=etcd-member.service
        Wants=cfn-etcd-environment.service
        After=cfn-etcd-environment.service
        After=network.target

        [Service]
        Type=oneshot
        RemainAfterExit=yes
        RestartSec=5
        EnvironmentFile=-/etc/etcd-environment
        EnvironmentFile=-/var/run/coreos/etcdadm-environment
        ExecStartPre=/usr/bin/systemctl is-active cfn-etcd-environment.service
        ExecStartPre=/usr/bin/mkdir -p /var/run/coreos/etcdadm/snapshots
        ExecStart=/opt/bin/etcdadm reconfigure
        ExecStartPost=/usr/bin/systemctl start etcdadm-check.timer
        TimeoutStartSec=120

        [Install]
        WantedBy=cfn-etcd-environment.service

    - name: etcdadm-update-status.service
      enable: true
      content: |
        [Unit]
        Description=etcdadm update status
        BindsTo=etcd-member.service
        After=etcd-member.service
        After=network.target

        [Service]
        Type=oneshot
        RemainAfterExit=yes
        RestartSec=5
        EnvironmentFile=-/etc/etcd-environment
        EnvironmentFile=-/var/run/coreos/etcdadm-environment
        ExecStart=/opt/bin/etcdadm member_status_set_started
        ExecStartPost=/usr/bin/systemctl start etcdadm-save.timer
        TimeoutStartSec=120

    - name: etcdadm-check.service
      enable: true
      content: |
        [Unit]
        Description=etcd health check

        [Service]
        Type=oneshot
        EnvironmentFile=-/etc/etcd-environment
        EnvironmentFile=-/var/run/coreos/etcdadm-environment
        ExecStartPre=/usr/bin/systemctl is-active etcd-member.service
        ExecStart=/opt/bin/etcdadm check
        TimeoutStartSec=120

    - name: etcdadm-check.timer
      enable: true
      content: |
        [Unit]
        Description=periodic etcd health check

        [Timer]
        OnBootSec=120sec
        # Actual interval would be OnUnitInactiveSec+0~AccuracySec=10+0~5 sec
        OnUnitInactiveSec=10sec
        AccuracySec=5sec

        [Install]
        WantedBy=timers.target

    - name: etcdadm-save.service
      enable: true
      content: |
        [Unit]
        Description=etcd snapshot

        [Service]
        Type=oneshot
        EnvironmentFile=-/etc/etcd-environment
        EnvironmentFile=-/var/run/coreos/etcdadm-environment
        ExecStartPre=/usr/bin/systemctl is-active etcd-member.service
        ExecStart=/opt/bin/etcdadm save
        TimeoutStartSec=300

    - name: etcdadm-save.timer
      enable: true
      content: |
        [Unit]
        Description=periodic etcd snapshot

        [Timer]
        OnBootSec=120sec
        # Actual interval would be 60+0~5 sec
        OnUnitInactiveSec=60sec
        AccuracySec=5sec

        [Install]
        WantedBy=timers.target

    - name: etcd-member.service
      drop-ins:
        - name: 20-aws-cluster.conf
          content: |
            [Unit]
            Wants=cfn-etcd-environment.service
            After=cfn-etcd-environment.service
            Wants=decrypt-assets.service
            After=decrypt-assets.service
            
            BindsTo=etcdadm-reconfigure.service etcdadm-update-status.service
            After=etcdadm-reconfigure.service
            Before=etcdadm-update-status.service
            [Service]
            EnvironmentFile=-/etc/etcd-environment

            PermissionsStartOnly=true
            ExecStartPre=/usr/bin/systemctl is-active cfn-etcd-environment.service
            ExecStartPre=/usr/bin/systemctl is-active decrypt-assets.service
            ExecStartPre=/usr/bin/chown -R etcd:etcd /var/lib/etcd2
        
        - name: 40-version.conf
          content: |
            [Service]
            Environment="ETCD_IMAGE_TAG=v3.1.8"
        
      enable: true
      command: start

    - name: var-lib-etcd2.mount
      enable: true
      content: |
        [Unit]
        Before=etcd-member.service

        [Mount]
        What=/dev/xvdf
        Where=/var/lib/etcd2
        Type=ext4

        [Install]
        RequiredBy=etcd-member.service

    - name: format-etcd2-volume.service
      enable: true
      content: |
        [Unit]
        Description=Formats etcd2 ebs volume
        After=dev-xvdf.device
        Requires=dev-xvdf.device
        Before=var-lib-etcd2.mount

        [Service]
        Type=oneshot
        RemainAfterExit=yes
        ExecStart=/opt/bin/ext4-format-volume-once /dev/xvdf

        [Install]
        RequiredBy=var-lib-etcd2.mount


    - name: decrypt-assets.service
      enable: true
      content: |
        [Unit]
        Description=decrypt etcd2 tls assets using amazon kms
        Before=etcd-member.service

        [Service]
        Restart=on-failure
        RemainAfterExit=yes
        ExecStartPre=/usr/bin/rkt run \
          --uuid-file-save=/var/run/coreos/decrypt-assets.uuid \
          --volume=ssl,kind=host,source=/etc/ssl/certs,readOnly=false \
          --mount=volume=ssl,target=/etc/ssl/certs \
          --volume=dns,kind=host,source=/etc/resolv.conf,readOnly=true \
          --mount volume=dns,target=/etc/resolv.conf \
          --net=host \
          --trust-keys-from-https \
        quay.io/coreos/awscli:master --exec=/bin/bash -- \
            -ec \
            'echo decrypting tls assets; \
             shopt -s nullglob; \
             for encKey in /etc/ssl/certs/*.pem.enc; do \
             echo decrypting $encKey; \
             /usr/bin/aws \
               --region us-east-1 kms decrypt \
               --ciphertext-blob fileb://$encKey \
               --output text \
               --query Plaintext \
             | base64 -d > $${encKey%.enc}; \
             done; \
             echo done.'
        ExecStart=-/usr/bin/rkt rm --uuid-file=/var/run/coreos/decrypt-assets.uuid

        [Install]
        RequiredBy=etcd-member.service



    - name: cfn-signal.service
      command: start
      content: |
        [Unit]
        Wants=etcd-member.service
        After=etcd-member.service

        [Service]
        Type=simple
        Restart=on-failure
        RestartSec=10

        EnvironmentFile=/var/run/coreos/etcd-node.env
        ExecStartPre=/usr/bin/systemctl is-active etcd-member.service
        ExecStartPre=/usr/bin/rkt fetch quay.io/coreos/awscli:master
        ExecStart=-/opt/bin/cfn-signal




write_files:
  - path: /etc/rkt/auth.d/docker.json
    permissions: 0600
    encoding: gzip+base64
    content: H4sIAAAAAAAA/6pWUCrKLvHOzEtRslJQSslPzk4tciwtyVDSAUuEpRYVZ+bngeTKDMFiqemZxSVFmanFSlYK0TBupa6hHkSvXma+UqyOglJyUWpKal5JZmIOSGG1glJpcWoRyJjk/JTUtJz88oKi/BSQgQWJxcXl+UVg60NLjaKcSqOS3EJDjDN8080CTAtylBRqa7kAAQAA//+faTbrpgAAAA==
  - path: /opt/bin/cfn-init-etcd-server
    owner: root:root
    permissions: 0700
    content: |
      #!/bin/bash -vxe

      cfn-init -v -c "etcd-server" --region us-east-1 --resource Etcd$KUBE_AWS_ETCD_INDEX --stack $KUBE_AWS_STACK_NAME

  - path: /opt/bin/attach-etcd-volume
    owner: root:root
    permissions: 0700
    content: |
      #!/bin/bash -vxe

      # To omit the `--region us-east-1` flag for every aws-cli invocation
      export AWS_DEFAULT_REGION=us-east-1

      instance_id=$(curl http://169.254.169.254/latest/meta-data/instance-id)
      az=$(curl http://169.254.169.254/latest/meta-data/placement/availability-zone)

      # values shared between cloud-config-etcd and stack-template.json
      stack_name=$KUBE_AWS_STACK_NAME
      name_tag_key="kube-aws:etcd:name"
      advertised_hostname_tag_key="kube-aws:etcd:advertised-hostname"
      eip_allocation_id_tag_key="kube-aws:etcd:eip-allocation-id"
      network_interface_id_tag_key="kube-aws:etcd:network-interface-id"

      etcd_index=$KUBE_AWS_ETCD_INDEX

      state_prefix=/var/run/coreos/etcd-volume
      output_prefix=/var/run/coreos/
      common_volume_filter="Name=tag:aws:cloudformation:stack-name,Values=$stack_name Name=tag:kube-aws:etcd:index,Values=$etcd_index"

      export $(cat /var/run/coreos/etcd-environment | grep -v ^# | xargs)

      export | grep ETCD

      # TODO: Locate the corresponding EBS volume via a tag on the ASG managing this EC2 instance
      # See https://github.com/coreos/kube-aws/pull/332#issuecomment-281531769

      # Skip the `while` block below when the EBS volume is already attached to this EC2 instance
      aws ec2 describe-volumes \
        --filters $common_volume_filter Name=attachment.instance-id,Values=$instance_id \
        | jq -r '([] + .Volumes)[0]' \
        > ${state_prefix}.json

      attached_vol_id=$(
        cat ${state_prefix}.json \
          | jq -r '"" + .VolumeId'
      )

      # Decide which volume to attach hence hostname to assume
      while [ "$attached_vol_id" = "" ]; do
        sleep 3

        aws ec2 describe-volumes \
          --filters $common_volume_filter Name=status,Values=available Name=availability-zone,Values=$az \
          > ${state_prefix}-candidates.json

        cat ${state_prefix}-candidates.json \
          | jq -r '([] + .Volumes)[0]' \
          > ${state_prefix}.json

        candidate_vol_id=$(
          cat ${state_prefix}.json \
            | jq -r '"" + .VolumeId'
        )

        if [ "$candidate_vol_id" = "" ]; then
          echo "[bug] no etcd volume found" 1>&2
          exit 1
        fi

        # See http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/device_naming.html for device naming
        if aws ec2 attach-volume --volume-id $candidate_vol_id --instance-id $instance_id --device "/dev/xvdf"; then
          attached_vol_id=$candidate_vol_id
        fi
      done

      # Wait until the volume attachment completes
      until [ "$volume_status" = ok ]; do
        sleep 3
        describe_volume_status_result=$(aws ec2 describe-volume-status --volume-id $attached_vol_id)
        volume_status=$(echo "$describe_volume_status_result" | jq -r "([] + .VolumeStatuses)[0].VolumeStatus.Status")
      done

      cat ${state_prefix}.json \
        | jq -r "([] + .Tags)[] | select(.Key == \"$name_tag_key\").Value" \
        > ${output_prefix}name

      cat ${state_prefix}.json \
        | jq -r "([] + .Tags)[] | select(.Key == \"$advertised_hostname_tag_key\").Value" \
        > ${output_prefix}advertised-hostname

      cat ${state_prefix}.json \
        | jq -r "([] + .Tags)[] | select(.Key == \"$eip_allocation_id_tag_key\").Value" \
        > ${output_prefix}eip-allocation-id

      cat ${state_prefix}.json \
        | jq -r "([] + .Tags)[] | select(.Key == \"$network_interface_id_tag_key\").Value" \
        > ${output_prefix}network-interface-id

  

  - path: /opt/bin/assume-advertised-hostname-with-eip
    owner: root:root
    permissions: 0700
    content: |
      #!/bin/bash -vxe

      # To omit the `--region us-east-1` flag for every aws-cli invocation
      export AWS_DEFAULT_REGION=us-east-1

      instance_id=$(curl http://169.254.169.254/latest/meta-data/instance-id)
      eip_alloc_id=$1

      aws ec2 associate-address --instance-id $instance_id --allocation-id $eip_alloc_id

      curl http://169.254.169.254/latest/meta-data/public-hostname

      curl http://169.254.169.254/latest/meta-data/local-ipv4 > /var/run/coreos/listen-private-ip

  - path: /opt/bin/append-etcd-server-env
    owner: root:root
    permissions: 0700
    content: |
      #!/bin/bash -vxe

      private_ip=$(cat /var/run/coreos/listen-private-ip)
      name=$(cat /var/run/coreos/name)
      advertised_hostname=$(cat /var/run/coreos/advertised-hostname)

      echo "KUBE_AWS_ASSUMED_HOSTNAME=$advertised_hostname
      ETCD_NAME=$name
      ETCD_PEER_TRUSTED_CA_FILE=/etc/ssl/certs/ca.pem
      ETCD_PEER_CERT_FILE=/etc/ssl/certs/etcd.pem
      ETCD_PEER_KEY_FILE=/etc/ssl/certs/etcd-key.pem

      ETCD_CLIENT_CERT_AUTH=true
      ETCD_TRUSTED_CA_FILE=/etc/ssl/certs/ca.pem
      ETCD_CERT_FILE=/etc/ssl/certs/etcd.pem
      ETCD_KEY_FILE=/etc/ssl/certs/etcd-key.pem

      ETCD_INITIAL_CLUSTER_STATE=new
      ETCD_DATA_DIR=/var/lib/etcd2
      ETCD_LISTEN_CLIENT_URLS=https://$private_ip:2379
      ETCD_ADVERTISE_CLIENT_URLS=https://$advertised_hostname:2379
      ETCD_LISTEN_PEER_URLS=https://$private_ip:2380
      ETCD_INITIAL_ADVERTISE_PEER_URLS=https://$advertised_hostname:2380" >> /var/run/coreos/etcd-environment

  - path: /opt/bin/cfn-etcd-environment
    owner: root:root
    permissions: 0700
    content: |
      #!/bin/bash -e

      run() {
        rkt run \
           --volume=dns,kind=host,source=/etc/resolv.conf,readOnly=true \
           --mount volume=dns,target=/etc/resolv.conf \
           --volume=awsenv,kind=host,source=/var/run/coreos,readOnly=false \
           --mount volume=awsenv,target=/var/run/coreos \
           --volume=optbin,kind=host,source=/opt/bin,readOnly=false \
           --mount volume=optbin,target=/opt/bin \
           --uuid-file-save=/var/run/coreos/$1.uuid \
           --set-env=KUBE_AWS_STACK_NAME=$KUBE_AWS_STACK_NAME \
           --set-env=KUBE_AWS_ETCD_INDEX=$KUBE_AWS_ETCD_INDEX \
           --net=host \
           --trust-keys-from-https \
           quay.io/coreos/awscli:master --exec=/opt/bin/$1 -- $2

           rkt rm --uuid-file=/var/run/coreos/$1.uuid || :
        }

      run cfn-init-etcd-server
      run attach-etcd-volume

      eip_allocation_id=$(cat /var/run/coreos/eip-allocation-id)
      network_interface_id=$(cat /var/run/coreos/network-interface-id)
      if [ "$eip_allocation_id" != "" ]; then
        run assume-advertised-hostname-with-eip $eip_allocation_id
      elif [ "$network_interface_id" != "" ]; then
        run assume-advertised-hostname-with-eni $network_interface_id
        /opt/bin/reconfigure-ip-routing
      else
        echo '[bug] neither eip_allocation_id nor network_interface_id for this node found'
      fi

      run append-etcd-server-env

      /usr/bin/sed -i "s/^ETCDCTL_ENDPOINT.*$/ETCDCTL_ENDPOINT=https:\/\/$(cat /var/run/coreos/advertised-hostname):2379/" /etc/environment

  - path: /opt/bin/etcdadm
    permissions: 0755
    encoding: gzip+base64
    content: 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

  - path: /etc/environment
    permissions: 0644
    content: |
      COREOS_PUBLIC_IPV4=$public_ipv4
      COREOS_PRIVATE_IPV4=$private_ipv4
      ETCDCTL_CA_FILE=/etc/ssl/certs/ca.pem
      ETCDCTL_CERT_FILE=/etc/ssl/certs/etcd-client.pem
      ETCDCTL_KEY_FILE=/etc/ssl/certs/etcd-client-key.pem
      ETCDCTL_ENDPOINT=

  - path: /opt/bin/ext4-format-volume-once
    permissions: 0700
    owner: root:root
    content: |
      #!/bin/bash -e
      if [[ "$(wipefs -n -p $1 | grep ext4)" == "" ]];then
        mkfs.ext4 $1
      else
        echo "volume $1 is already formatted"
      fi


  - path: /opt/bin/cfn-signal
    owner: root:root
    permissions: 0700
    content: |
      #!/bin/bash -e

      rkt run \
        --volume=dns,kind=host,source=/etc/resolv.conf,readOnly=true \
        --mount volume=dns,target=/etc/resolv.conf \
        --volume=awsenv,kind=host,source=/var/run/coreos,readOnly=false \
        --mount volume=awsenv,target=/var/run/coreos \
        --uuid-file-save=/var/run/coreos/cfn-signal.uuid \
        --set-env=KUBE_AWS_STACK_NAME=$KUBE_AWS_STACK_NAME \
        --set-env=KUBE_AWS_ETCD_INDEX=$KUBE_AWS_ETCD_INDEX \
        --net=host \
        --trust-keys-from-https \
        quay.io/coreos/awscli:master --exec=/bin/bash -- \
          -vxec \
          '
           cfn-signal -e 0 --region us-east-1 --resource Etcd$KUBE_AWS_ETCD_INDEX --stack $KUBE_AWS_STACK_NAME
          '

      rkt rm --uuid-file=/var/run/coreos/cfn-signal.uuid || :




  - path: /etc/ssl/certs/ca.pem.enc
    encoding: gzip+base64
    content: H4sIAAAAAAAA/wC/BED7AQECAHgtAXNFpLmjNXHaaI4vnp9Kiu39c7e3/npF4nDh5ZaiJwAABJYwggSSBgkqhkiG9w0BBwagggSDMIIEfwIBADCCBHgGCSqGSIb3DQEHATAeBglghkgBZQMEAS4wEQQMIavdC0gAhlrmBg9qAgEQgIIESel5KdSj6HqSutYosDVzrkNvjnvi2q2dDWDwq+ctxFrAfauDsHuI1CNPJGtnmPrpjDEPbOhF0Tr3a4j0vWAt1Yycamc+RocCDASS9KWh8gvDanF8Dll6n+CdzgKMxatvA5x7Z0JcHo+yh1vsYMLLQCm0UWiru8Tr6j18+ZbD7z6BtmshpFKwbosWZotuqSLTBhYfuFIORUwXphGuCyJatmK14SbKA/4vblculPFDwc6OnqwJMcxbOoUgc8dVl/M8XHTudopDWrDYXtrMHpjyuzDgYqx8/DImdV5Mer66ftflF0O7RbB3JRyTPWd9vMzrE5g2yPKVh1wTb/tV+anU74WEuex1eCPBpxWfJyzGT8uP8UPngxsOocuVfOqUwXpYiwLA5teAJHRu2RVUwMurWnzeCVGvj6O9OHD53MOh5mG3+mfv3ZLZkJ4hOa/Ld/O4gn4E7dSFZZ76QRTI5Y9gFVYUhm39cH71fSFuH3Yb0UzL7xkT8w+bnXMPlx2ujKTElDE3XxRfW4yY4CPOEqP9FWQzgJwQpAo0oKL/INDUsjj3SUeGknd46fyKpItUniGiOLzfjFf8IMD+fqXtg5o3YofSR1dxoC28pNEDYWnaheeRJHL7cMs7TP5pSRYxPXxMTsOUleBPfj31EDp4NIyG24AFEpkoFCQt6xL3WXuvEgvqoctoZqhlD9pd2viUGN38TfjjB2Eur20YQAoOX74juIK5nvS3Iuwbi+6bxv8AdqPQkUC/sA/7bxTlorjvMQSdLg2yB3+qn6CLDEqs0Sa0Y40pN0T9uJ4cpAIBgev37I7+ZCT3c7bm2ljsSEmzeziNnatq44MZ7VYEGAXlegLwgyRYKjm0dLqVVJMlU1FTrdeyIRHYrb3glCI1o6PCZbaVCpONzzZIqEkcgGJYxTgso4HLv0ty9O61ziEjo3XUf9hLXrVekvV5kNJi/b4fOm04kT7loyFV05eaDWFmKMV8wbUn8kH96OH0+/b5ErsQMI1t71z0sZjzQ9CjvOn3HlQE7q8lb1XL5iNi4dBSuJb9xPlI66+gRRbxBeTPx6CauW3jOfMZIUnpYugljz1BTwiRHNvf99Rn3Jd21YhgoJqgyaP7JSIuCmbwXdpPQxs+vd7/r3wLcjum7GbZL0rjIp5FJu2h3VKa0Z7kzaBT87Jj0jadz2WOcFb2vkrrYmXE5PGJvnzqyKEa0kPiuaCxsW6fj8+DOs6BhdBgAaZ+3cAhUE7Ns/vXcCxWOpTadVkFvjJsfwH6fTVGN4G1qhuAK6fwPUWtR4trZ2vtuAWt2oOWXSMyZx/hWR7Cagl4ZzCzE/8IDAqtViW2z4Vn0Cc6NYHkfsGhFa/rwikalTGnQHpwaqLsiqIhRuCGuBf1Wtr8SKPEuQM9x5thKxOmtYNcBhVtmnvmCY5cOZi3xS7FKis4YiLJeeZGvPk1AvXbtvEW/Q6TMUC+Q9PL6wHOAQAA//+JGEI6vwQAAA==

  - path: /etc/ssl/certs/etcd-key.pem.enc
    encoding: gzip+base64
    content: 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

  - path: /etc/ssl/certs/etcd.pem.enc
    encoding: gzip+base64
    content: H4sIAAAAAAAA/wAEBfv6AQECAHgtAXNFpLmjNXHaaI4vnp9Kiu39c7e3/npF4nDh5ZaiJwAABNswggTXBgkqhkiG9w0BBwagggTIMIIExAIBADCCBL0GCSqGSIb3DQEHATAeBglghkgBZQMEAS4wEQQMORO5nD4CoQmnenqIAgEQgIIEjqcOaFct9XzJM8L/t/ZG9ej6LhEd6ZiUc+hOAMluAYEeye7KdOFWPnpgNkyhPeZKQH2xjgUECiwteXe1kpqmGoj2ZWGoMUcqQj/tgHtZtqiI96N2zG4wBCAJusStFF8bAmdRJtvZXu1Srl54Jq5SOzigtWWz2UdGScf2IB+JoOML6mhlWMLlvp7DpdgvYL6VPVBS7bg+BJ2Oc1MeQP8p1GL5EJNH677rux3Qtr3mIMSFuO5mCxy6D8bXjOF8a6Fmh6BctJSFgpmllJrqH+bGq0Jh3/N6KRXvEdIyfCAhv96rHW8/gZEJ0IvD0rnaCldiQKXInSFkne/OGqBCHygn0w2A1Rr728oyjw3WlLwt6q8+e/IdCB9k56ynkpedmxt7kHHkECkrdGCivKL6DEvLhOzYYxy0T4z0mgIX0Fr7FjzZZiSX+p124NptYxXBLTZatMr/C/0bHY3gjCCp0o/GKZYxNpIAZnRvlGBQVWDUa4PUr7pSCpKouOnpIEoEJ18bjXFLNLx7/2GNFxVJwbZPIWvzLR7/sdjkEO7kSY8iA1fmaE7hzEzl/yICY99VYSd5+oiwqyNAo8bvqeCt+0/hLE3iM+xHKvrTJJFvn/6EZVP68F2LCftaUmRA0n8pPMzq1EyUDpK8OT7fUpB0Ua367OYG1hG1kXPYIqZ1cx9eDsXotywsVRKPT/2qSaXzij+iUG8RWDZPylRUIRWAkvccLUCY9GuQMaIahdZdAv87KqZThifmGexmmBgTUWjPY1EE/uU4a6faanyMiB7niXDDJop435DpqOhlGEPNa6zCTRVJp2uEa9Z1fPfLVMaiyf8sJiEuqGO+rnhoMX2qkZZh1jyRXG3f2DgWtgnCvd3Nptdmg3fPKhk9ZShIq/65xC2pXPh0Mm+rTuN/X6PW1ymf3lLlwHzygUDFY+v6cM36fA5wiIButdfq2voC8J4O/LaKPgAC0yqFd4wJQxRhRtsYcEbFjICOxtyn/F+3LKwoKXtq9I9B/Hdrsq6qxtICX5DTU8q7Iyubp8oOeP1QuX0GGgbq5zo/N2JNg/27tL83rK9qPLRxKb0/QfJIs/PdeCkbl9I2Qlm0oTuPkKhD9ueZfSMrAqAal3M0qE40ElI4RIdrRaux5qqlisWM6MzaUiEs8p9IvMHHYyBAC5tMvdn1FVlHc5x1EkKitAZDqc7ATpBjOgXfnMUbfVfNu73ipraFMRLHh1yQRVwNcVjw3m/S5ylBkifAvqckoJZq0ePVXHwUMFkSoDrFHJ++nqOLsPZEVi7LJeZVFKkQ03gw/DAdQB4gBBdYH4Tx7refabUPIm1oGeAhddQ+ujAIMuKpZkTJQ9IsA3baE7k6+tfPMUg7g+PAhJSRxWuWgLciYf14+jXMe+OvfW8W7C8mUFCeGbXq9jFoiYRVHXR2FkMPKqGyYcobj+91nPGO1fnKYlN6dUdw5J0pmSqG2VCZ5J7bK7JuobVGyqHBL7nUqTPmXblr1XPqQvXV91GpaV9Z43uuMm/VS8lcNXzFbkot+R1s6cuXRkgpoREjXI0KrOo8FyMWAQAA//8JGg6sBAUAAA==

  - path: /etc/ssl/certs/etcd-client.pem.enc
    encoding: gzip+base64
    content: H4sIAAAAAAAA/wDXBCj7AQECAHgtAXNFpLmjNXHaaI4vnp9Kiu39c7e3/npF4nDh5ZaiJwAABK4wggSqBgkqhkiG9w0BBwagggSbMIIElwIBADCCBJAGCSqGSIb3DQEHATAeBglghkgBZQMEAS4wEQQMqgGl0NQOq6JNbc53AgEQgIIEYc+xRpRXbldPjRfenrc5y15CnOSMqCD7D106gJjONXH4+veet6jcXHTI//6PQ7xw2D0LI/HzxnMZbk1EQwjlfGr+NHHkViuFLPkYtbZCp6S3nNzycn7DwnPe+K80mGQu7OF5lGia9pkQ+ufpxuk/RFJmDBOXCr2RwWLn26F6Y3Da1bmjUsSDDwYlyqPWF2fXV2BG5Ir7J+Dl9gSGg3VEGz5zyj4YPlWNcLiiVx8ZtcFBQMHk5blv4wEkZyFsHTugnFgJSMKVMGSNus+vzuw7IPOhNESKhdGtOe5Fc30qFWCtCxTScr+jfDBq3EzAfwg9xNG38NakLA5I9amm73t4Umk2V16dGcvNrgNoaV8WmGp9fstVluBObpLtLSltiVkod+DeVp72+umzquNFov387EyU3KOt1ggt6x8JEXrwXz/O7wv22Q1twgQHApsph0ikPo1OlkdOU0CpKAaF5fyrMI7WKrMJIzkmIFjd2aE/PFfvkZ16MxpXDCrQPrbvj4ndSdYdhYGS1ukHO00H31eiJbs3aFlq2bbBWqIf9svZ1OuzQGIiVW/aLz2QEOytMP3/+M3EX6NbvaH8KtDqUWNXLDk23Uyay6elKUpCtlrFJf6Aj5jIvin2rjIUJWKbpEqVIuuq1WWYxYSsIf+9yPyg1XFcSaQy4Wt4KqHU0pJ7hXOXCce5B/rLGYBpdbnioEInwsBNHdZmwutz6KTRGSEVrif/7/21gaK41PipMjyeu8i9rLdc8jMC254T4FNC4CyY55WpRUCBfEvtYgr9R21OfnAl4utshQgPRNSDRcACJGKcGrPm35GEjjjdUwX4QTRUXimhY4AAw0bK3CuOORO7T+Pt9y8I19dA7la11PZk2JOcx0/9cLktV12sYFAm8tnEgjUVamIiBmFdfeM9NN3Sx+uRZbyZv7gPTAB+bSA/XHIeSHXgK3SzwRhMnROFVujfIu9boJL+eQZBq9GHQKEG05kpQfNVte48ta8s/qB0tOHP8YYNg5ziVcnB2zq5yITUj0XdA8dxYrf9C3b/CtmBGJIxi05VYug7EzmLZsUzkviOBKF0o6PhJxlpik2lDJ9fXr69bifCUIq9sMVHLvQFFK4aGq7NSRpJJUNtrfFXh5hB82UWrrLo6Wafl71LS0bzMec7EFQ8Ira8bUuXIyhfQkHjqkFcXeOZlteBBg9PvV5QJ40sfy+OwPC6ClFU+OUcbbhld8Lt1N8UoY6u9FFZ2hZlXlaj5Kzj2t02NkYLdNXb1PrO3vQhbL+0mnkaocObQDvComQk0jXIrZ/1wNItWTwt+irFruQQjcEP8S/UV34dEvBQlYJD+z6gKdTm3SCMx7PiBo5gRqs/fFo9U9Oo3JfIXcEsjzKeF+mIthdYUE1FAsZQJ+4HuCANn6xWYItDfOM8NvBhzp5sKM7ZmAS4rd2sFUVfVrmmt+JdMEF1iMDPM7mMeu+s7bxQYBJfW9w9Ku8Gn4kVQo6TsZ4U9BYKPzg0AQAA//+sLaaz1wQAAA==

  - path: /etc/ssl/certs/etcd-client-key.pem.enc
    encoding: gzip+base64
    content: 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


